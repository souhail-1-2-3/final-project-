<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quiz Culture G√©n√©rale</title>
  <style>
    :root {
      --bg: #181c2f;
      --card-bg: rgba(24,28,47,0.97);
      --text: #fff;
      --primary: #1de9b6;
      --secondary: #7c4dff;
      --accent: #ff4081;
      --shadow: #7c4dff;
    }
    body {
      font-family: 'Orbitron', 'Arial', sans-serif;
      background: var(--bg) !important;
      color: var(--text) !important;
      margin: 0;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      letter-spacing: 1px;
    }

    h1 {
      color: var(--primary);
      margin-bottom: 20px;
      text-shadow: 0 0 12px var(--primary), 0 0 40px var(--secondary);
      font-size: 2.5em;
      font-family: 'Orbitron', 'Arial', sans-serif;
      letter-spacing: 2px;
    }

    .card {
      background: var(--card-bg) !important;
      color: var(--text) !important;
      border-radius: 18px;
      box-shadow: 0 0 24px var(--shadow), 0 0 4px #fff3;
      padding: 28px;
      margin: 18px;
      width: 340px;
      border: 2px solid var(--primary);
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: linear-gradient(120deg, #1de9b6 0%, #ff4081 100%);
      opacity: 0.10;
      z-index: 0;
      pointer-events: none;
    }

    .card:hover {
      transform: scale(1.03) rotate(-1deg);
      box-shadow: 0 0 40px #1de9b6, 0 0 8px #ff4081;
    }

    .question {
      font-weight: bold;
      margin-bottom: 18px;
      color: #fff;
      font-size: 1.15em;
      text-shadow: 0 0 6px #1de9b6;
      position: relative;
      z-index: 1;
    }

    .answers button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg, #1de9b6 0%, #ff4081 100%);
      color: #fff;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 0 10px #7c4dff, 0 0 2px #ff4081;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
      outline: none;
      position: relative;
      z-index: 1;
    }

    .answers button:hover:not(:disabled) {
      background: linear-gradient(90deg, #ff4081 0%, #1de9b6 100%);
      transform: scale(1.04);
      box-shadow: 0 0 20px #ff4081, 0 0 8px #1de9b6;
    }

    .answers button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      filter: grayscale(0.5);
    }

    .result {
      margin-top: 12px;
      font-weight: bold;
      font-size: 1.1em;
      text-shadow: 0 0 8px #fff, 0 0 16px #1de9b6;
      min-height: 1.5em;
      position: relative;
      z-index: 1;
    }

    #scoreboard {
      margin: 22px 0;
      font-size: 1.3em;
      color: #ff4081;
      text-shadow: 0 0 10px #1de9b6, 0 0 20px #7c4dff;
      font-family: 'Orbitron', 'Arial', sans-serif;
      letter-spacing: 2px;
    }

    #restart {
      padding: 12px 28px;
      background: linear-gradient(90deg, #ff4081 0%, #1de9b6 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 28px;
      font-size: 1.1em;
      font-family: 'Orbitron', 'Arial', sans-serif;
      font-weight: bold;
      box-shadow: 0 0 16px #ff4081, 0 0 8px #7c4dff;
      transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
    }

    #restart:hover {
      background: linear-gradient(90deg, #1de9b6 0%, #ff4081 100%);
      box-shadow: 0 0 32px #1de9b6, 0 0 16px #ff4081;
      transform: scale(1.05);
    }

    /* Import Orbitron font for a futuristic look */
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');

    .menu-btn {
      padding: 12px 24px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg, #1de9b6 0%, #7c4dff 100%);
      color: #fff;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 0 10px #7c4dff, 0 0 2px #ff4081;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
      outline: none;
      display: inline-block;
    }

    .menu-btn:hover {
      background: linear-gradient(90deg, #ff4081 0%, #1de9b6 100%);
      transform: scale(1.04);
      box-shadow: 0 0 20px #ff4081, 0 0 8px #1de9b6;
    }

    @media (max-width: 600px) {
      body {
        padding: 8px;
      }
      .card, #timer-bar {
        width: 98vw !important;
        min-width: unset;
        max-width: 100vw;
        box-sizing: border-box;
        padding: 12px !important;
        margin: 8px 0 !important;
      }
      h1 {
        font-size: 1.3em !important;
        margin-bottom: 10px !important;
        text-align: center;
        word-break: break-word;
      }
      #scoreboard {
        font-size: 1em !important;
        margin: 12px 0 !important;
      }
      .answers button, .menu-btn, #restart, #back {
        font-size: 1em !important;
        padding: 10px 0 !important;
        margin: 7px 0 !important;
        min-width: 0;
        width: 100%;
        box-sizing: border-box;
      }
      .menu-btn {
        padding: 10px 0 !important;
        font-size: 1em !important;
      }
      .result, .explication {
        font-size: 1em !important;
      }
    }
  </style>
</head>
<body>

  <button id="theme-toggle" style="position:fixed;top:18px;right:18px;z-index:1000;padding:10px 18px;border-radius:8px;border:none;cursor:pointer;font-family:'Orbitron',Arial,sans-serif;font-weight:600;background:linear-gradient(90deg,#1de9b6 0%,#7c4dff 100%);color:#fff;box-shadow:0 0 10px #7c4dff,0 0 2px #ff4081;transition:background 0.2s;">
    Mode clair/sombre
  </button>

  <h1>üß† Quiz Culture G√©n√©rale</h1>
  <div id="scoreboard">Score : 0 / 3</div>

  <button id="restart" onclick="restartQuiz()">Recommencer</button>
  <button id="back" onclick="goBack()" style="margin-top:12px;padding:10px 24px;background:linear-gradient(90deg,#00ffe7 0%,#ff00cc 100%);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1em;font-family:'Orbitron','Arial',sans-serif;font-weight:bold;box-shadow:0 0 10px #00ffe7,0 0 2px #ff00cc;transition:background 0.2s,box-shadow 0.2s,transform 0.2s;">
    Retour au menu
  </button>

  <div id="menu" style="display:none;">
    <button class="menu-btn" onclick="startQuiz('culture')">Culture g√©n√©rale</button>
    <button class="menu-btn" onclick="startQuiz('islam')">Culture islamique</button>
    <button class="menu-btn" onclick="startQuiz('histoire')">Histoire</button>
    <button class="menu-btn" onclick="startQuiz('geo')">G√©ographie</button>
    <button class="menu-btn" onclick="startQuiz('autres')">Autres</button>
    <button class="menu-btn" onclick="startQuiz('sport')">Sport</button>
    <div style="margin-top:20px;">
      <label style="color:#fff;font-size:1em;">
        <input type="checkbox" id="no-timer" style="transform:scale(1.3);margin-right:8px;">
        Mode sans timer (relax)
      </label>
    </div>
  </div>
  <div id="timer-bar" style="width:340px;height:10px;background:#222;border-radius:6px;overflow:hidden;margin:18px auto 0 auto;display:none;">
    <div id="timer-progress" style="height:100%;background:linear-gradient(90deg,#ff4081,#1de9b6);width:100%;transition:width 0.2s;"></div>
  </div>

  <script>
    // Palette claire
    const lightTheme = {
      '--bg': '#f7f7fa',
      '--card-bg': '#fff',
      '--text': '#181c2f',
      '--primary': '#1de9b6',
      '--secondary': '#7c4dff',
      '--accent': '#ff4081',
      '--shadow': '#e0e0e0'
    };
    // Palette sombre (par d√©faut)
    const darkTheme = {
      '--bg': '#181c2f',
      '--card-bg': 'rgba(24,28,47,0.97)',
      '--text': '#fff',
      '--primary': '#1de9b6',
      '--secondary': '#7c4dff',
      '--accent': '#ff4081',
      '--shadow': '#7c4dff'
    };
    // Applique le th√®me
    function applyTheme(theme) {
      for (const key in theme) {
        document.documentElement.style.setProperty(key, theme[key]);
      }
    }
    // D√©tecte le th√®me actuel
    function isDark() {
      return (localStorage.getItem('theme') || 'dark') === 'dark';
    }
    // Initialise le th√®me au chargement
    function initTheme() {
      if (isDark()) applyTheme(darkTheme);
      else applyTheme(lightTheme);
    }
    // Toggle
    document.getElementById('theme-toggle').onclick = function() {
      const dark = isDark();
      localStorage.setItem('theme', dark ? 'light' : 'dark');
      initTheme();
    };
    initTheme();
  </script>

  <script>
// Ajoute ou compl√®te chaque cat√©gorie dans ton objet questionsByCategory :

const questionsByCategory = {
  culture: [
    { question: "Quel est le plus grand oc√©an du monde ?", answers: ["Atlantique", "Indien", "Pacifique"], correct: "Pacifique" },
    { question: "Qui a peint la Joconde ?", answers: ["Van Gogh", "L√©onard de Vinci", "Picasso"], correct: "L√©onard de Vinci" },
    { question: "Combien y a-t-il de continents ?", answers: ["5", "6", "7"], correct: "7" },
    { question: "Quel est le plus long fleuve du monde ?", answers: ["Nil", "Amazone", "Yangts√©"], correct: "Amazone" },
    { question: "Dans quel pays se trouve la Tour Eiffel ?", answers: ["Italie", "France", "Espagne"], correct: "France" },
    { question: "Quel est le symbole chimique de l‚Äôeau ?", answers: ["O2", "H2O", "CO2"], correct: "H2O" },
    { question: "Qui a √©crit 'Le Petit Prince' ?", answers: ["Victor Hugo", "Saint-Exup√©ry", "Moli√®re"], correct: "Saint-Exup√©ry" },
    { question: "Quel est l‚Äôanimal le plus rapide du monde ?", answers: ["Gu√©pard", "Aigle", "Lion"], correct: "Gu√©pard" },
    { question: "Combien de couleurs dans l‚Äôarc-en-ciel ?", answers: ["5", "7", "9"], correct: "7" },
    { question: "Quel est le plus grand d√©sert du monde ?", answers: ["Sahara", "Gobi", "Kalahari"], correct: "Sahara" }
  ],
  islam: [
    { question: "Combien de piliers de l‚ÄôIslam ?", answers: ["3", "5", "7"], correct: "5" },
    { question: "Quel est le livre sacr√© de l‚ÄôIslam ?", answers: ["Bible", "Torah", "Coran"], correct: "Coran" },
    { question: "Dans quelle ville est n√© le Proph√®te Muhammad ?", answers: ["M√©dine", "La Mecque", "J√©rusalem"], correct: "La Mecque" },
    { question: "Quel mois est d√©di√© au je√ªne ?", answers: ["Chawwal", "Ramadan", "Dhou al-Hijja"], correct: "Ramadan" },
    { question: "Combien de pri√®res quotidiennes ?", answers: ["3", "5", "7"], correct: "5" },
    { question: "Quel est le premier calife ?", answers: ["Ali", "Omar", "Abou Bakr"], correct: "Abou Bakr" },
    { question: "Quel animal a transport√© le Proph√®te lors de l‚ÄôIsra et Miraj ?", answers: ["Chameau", "Bouraq", "Cheval"], correct: "Bouraq" },
    { question: "Quel est le nom du dernier Proph√®te ?", answers: ["Moussa", "Issa", "Muhammad"], correct: "Muhammad" },
    { question: "O√π se trouve la Kaaba ?", answers: ["M√©dine", "La Mecque", "Bagdad"], correct: "La Mecque" },
    { question: "Quel est le jour sacr√© de la semaine ?", answers: ["Samedi", "Dimanche", "Vendredi"], correct: "Vendredi" }
  ],
  histoire: [
    { question: "Qui √©tait Napol√©on Bonaparte ?", answers: ["Un roi", "Un empereur", "Un peintre"], correct: "Un empereur" },
    { question: "En quelle ann√©e a eu lieu la R√©volution fran√ßaise ?", answers: ["1789", "1815", "1914"], correct: "1789" },
    { question: "Qui a d√©couvert l‚ÄôAm√©rique ?", answers: ["Magellan", "Christophe Colomb", "Vasco de Gama"], correct: "Christophe Colomb" },
    { question: "Quel mur est tomb√© en 1989 ?", answers: ["Mur de Berlin", "Mur de Chine", "Mur d‚ÄôHadrien"], correct: "Mur de Berlin" },
    { question: "Qui √©tait Cl√©op√¢tre ?", answers: ["Une reine d‚Äô√âgypte", "Une d√©esse grecque", "Une imp√©ratrice romaine"], correct: "Une reine d‚Äô√âgypte" },
    { question: "Quel roi a eu pour surnom 'le Roi Soleil' ?", answers: ["Louis XIV", "Louis XVI", "Henri IV"], correct: "Louis XIV" },
    { question: "O√π se trouve la cit√© antique de Machu Picchu ?", answers: ["P√©rou", "Mexique", "Br√©sil"], correct: "P√©rou" },
    { question: "Qui a invent√© l‚Äôimprimerie ?", answers: ["Gutenberg", "Pasteur", "Newton"], correct: "Gutenberg" },
    { question: "Quel empire a construit le Colis√©e ?", answers: ["Grec", "Romain", "√âgyptien"], correct: "Romain" },
    { question: "Qui √©tait Jeanne d‚ÄôArc ?", answers: ["Une reine", "Une guerri√®re", "Une scientifique"], correct: "Une guerri√®re" }
  ],
  geo: [
    { question: "Quel est le plus grand pays du monde ?", answers: ["Canada", "Russie", "Chine"], correct: "Russie" },
    { question: "O√π se trouve le Kilimandjaro ?", answers: ["Kenya", "Tanzanie", "Afrique du Sud"], correct: "Tanzanie" },
    { question: "Quel est le plus long fleuve d‚ÄôAfrique ?", answers: ["Nil", "Congo", "Niger"], correct: "Nil" },
    { question: "Quelle est la capitale du Japon ?", answers: ["P√©kin", "Tokyo", "S√©oul"], correct: "Tokyo" },
    { question: "Quel oc√©an borde la c√¥te ouest de l‚ÄôAfrique ?", answers: ["Atlantique", "Indien", "Arctique"], correct: "Atlantique" },
    { question: "Quel pays a la plus grande population ?", answers: ["Inde", "Chine", "√âtats-Unis"], correct: "Chine" },
    { question: "Quel est le plus haut sommet du monde ?", answers: ["K2", "Everest", "Mont Blanc"], correct: "Everest" },
    { question: "Dans quel pays se trouve la ville de Sydney ?", answers: ["Australie", "Nouvelle-Z√©lande", "Canada"], correct: "Australie" },
    { question: "Quel est le plus grand d√©sert chaud ?", answers: ["Sahara", "Gobi", "Kalahari"], correct: "Sahara" },
    { question: "Quelle mer s√©pare l‚ÄôEurope de l‚ÄôAfrique ?", answers: ["Mer Rouge", "M√©diterran√©e", "Mer Noire"], correct: "M√©diterran√©e" }
  ],
  sport: [
    { question: "Quel pays a remport√© la Coupe du Monde 2018 ?", answers: ["France", "Br√©sil", "Allemagne"], correct: "France" },
    { question: "Combien de joueurs dans une √©quipe de football ?", answers: ["9", "10", "11"], correct: "11" },
    { question: "Quel est le sport de Michael Jordan ?", answers: ["Football", "Basketball", "Tennis"], correct: "Basketball" },
    { question: "Combien de points pour un essai au rugby ?", answers: ["3", "5", "7"], correct: "5" },
    { question: "Dans quel pays sont n√©s les Jeux Olympiques ?", answers: ["Italie", "Gr√®ce", "France"], correct: "Gr√®ce" },
    { question: "Quel est le surnom d‚ÄôUsain Bolt ?", answers: ["La Fus√©e", "L‚Äô√âclair", "La Fl√®che"], correct: "L‚Äô√âclair" },
    { question: "Combien de sets pour gagner un match de tennis masculin en Grand Chelem ?", answers: ["2", "3", "5"], correct: "3" },
    { question: "Quel est le record du 100m (en secondes) ?", answers: ["9.58", "9.72", "9.63"], correct: "9.58" },
    { question: "Combien de joueurs sur le terrain au basket (une √©quipe) ?", answers: ["5", "6", "7"], correct: "5" },
    { question: "Quel pays a gagn√© le plus de m√©dailles olympiques ?", answers: ["Chine", "√âtats-Unis", "Russie"], correct: "√âtats-Unis" },
    { question: "Quel est le sport le plus pratiqu√© au monde ?", answers: ["Football", "Basketball", "Tennis"], correct: "Football" },
    { question: "Combien de joueurs dans une √©quipe de volley-ball ?", answers: ["5", "6", "7"], correct: "6" },
    { question: "Quel est le pays d‚Äôorigine du judo ?", answers: ["Chine", "Japon", "Cor√©e"], correct: "Japon" },
    { question: "Combien de minutes dure un match de football ?", answers: ["90", "80", "100"], correct: "90" },
    { question: "Quel est le record du saut en longueur masculin (en m√®tres) ?", answers: ["8.95", "9.10", "8.50"], correct: "8.95" },
    { question: "Quel est le sport de Serena Williams ?", answers: ["Tennis", "Golf", "Basketball"], correct: "Tennis" },
    { question: "Combien de joueurs dans une √©quipe de handball ?", answers: ["7", "6", "8"], correct: "7" },
    { question: "Quel est le pays d‚Äôorigine du rugby ?", answers: ["Angleterre", "France", "Australie"], correct: "Angleterre" },
    { question: "Quel est le sport de Tony Parker ?", answers: ["Basketball", "Football", "Rugby"], correct: "Basketball" },
    { question: "Combien de tours dans une course de 400m ?", answers: ["1", "2", "4"], correct: "1" }
  ],
  math: [
    { question: "Combien font 7 + 5 ?", answers: ["11", "12", "13"], correct: "12" },
    { question: "Quel est le r√©sultat de 6 √ó 8 ?", answers: ["42", "48", "54"], correct: "48" },
    { question: "Combien font 36 √∑ 6 ?", answers: ["5", "6", "7"], correct: "6" },
    { question: "Qui est consid√©r√© comme le p√®re de la g√©om√©trie ?", answers: ["Euclide", "Pythagore", "Archim√®de"], correct: "Euclide" },
    { question: "Quel est le carr√© de 9 ?", answers: ["18", "81", "27"], correct: "81" },
    { question: "Quel math√©maticien grec a donn√© son nom √† un c√©l√®bre th√©or√®me sur les triangles rectangles ?", answers: ["Pythagore", "Thal√®s", "Eratosth√®ne"], correct: "Pythagore" },
    { question: "Combien font 15 ‚Äì 7 ?", answers: ["8", "7", "9"], correct: "8" },
    { question: "Quel est le r√©sultat de 5 √ó 7 ?", answers: ["35", "25", "30"], correct: "35" },
    { question: "Quel math√©maticien a invent√© le symbole ‚àû pour l‚Äôinfini ?", answers: ["Newton", "Leibniz", "John Wallis"], correct: "John Wallis" },
    { question: "Combien font 100 √∑ 4 ?", answers: ["20", "25", "30"], correct: "25" },
    { question: "Combien font 9 √ó 9 ?", answers: ["81", "72", "99"], correct: "81" },
    { question: "Quel est le r√©sultat de 49 √∑ 7 ?", answers: ["6", "7", "8"], correct: "7" },
    { question: "Qui a d√©velopp√© la th√©orie de la relativit√© ?", answers: ["Einstein", "Newton", "Gauss"], correct: "Einstein" },
    { question: "Combien font 13 + 17 ?", answers: ["30", "29", "31"], correct: "30" },
    { question: "Quel est le r√©sultat de 8 √ó 7 ?", answers: ["54", "56", "64"], correct: "56" },
    { question: "Quel est le nom du math√©maticien indien c√©l√®bre pour ses formules ?", answers: ["Ramanujan", "Gauss", "Euler"], correct: "Ramanujan" },
    { question: "Combien font 144 √∑ 12 ?", answers: ["10", "12", "14"], correct: "12" },
    { question: "Quel est le r√©sultat de 100 ‚Äì 37 ?", answers: ["63", "73", "67"], correct: "63" },
    { question: "Quel est le nombre PI arrondi √† 2 d√©cimales ?", answers: ["3.14", "3.15", "3.13"], correct: "3.14" },
    { question: "Quel math√©maticien a donn√© son nom √† une suite c√©l√®bre ?", answers: ["Fibonacci", "Pascal", "Descartes"], correct: "Fibonacci" }
  ],
  autres: [
    { question: "Quel est le plus grand animal terrestre ?", answers: ["√âl√©phant", "Girafe", "Rhinoc√©ros"], correct: "√âl√©phant" },
    { question: "Quel est le plus grand volcan actif ?", answers: ["Etna", "Kilauea", "Mauna Loa"], correct: "Mauna Loa" },
    { question: "Quel est le m√©tal le plus l√©ger ?", answers: ["Aluminium", "Lithium", "Fer"], correct: "Lithium" },
    { question: "Quel est le plus grand archipel du monde ?", answers: ["Indon√©sie", "Philippines", "Japon"], correct: "Indon√©sie" },
    { question: "Quel est l‚Äôanimal qui pond le plus d‚Äô≈ìufs ?", answers: ["Poule", "Poisson-lune", "Autruche"], correct: "Poisson-lune" },
    { question: "Quel est le fruit le plus consomm√© au monde ?", answers: ["Banane", "Pomme", "Orange"], correct: "Banane" },
    { question: "Quel est le plus grand lac d‚Äôeau douce ?", answers: ["Lac Ba√Økal", "Lac Sup√©rieur", "Lac Victoria"], correct: "Lac Sup√©rieur" },
    { question: "Quel est le plus grand mammif√®re marin ?", answers: ["Orque", "Baleine bleue", "Dauphin"], correct: "Baleine bleue" },
    { question: "Quel est le plus haut arbre du monde ?", answers: ["S√©quoia", "Ch√™ne", "Baobab"], correct: "S√©quoia" },
    { question: "Quel est le plus petit pays du monde ?", answers: ["Monaco", "Vatican", "Saint-Marin"], correct: "Vatican" },
    { question: "Quel est le plus grand oiseau du monde ?", answers: ["Autruche", "Aigle", "Albatros"], correct: "Autruche" },
    { question: "Quel est l‚Äôinstrument de musique √† cordes le plus grand ?", answers: ["Contrebasse", "Guitare", "Violon"], correct: "Contrebasse" },
    { question: "Quel est le plus grand d√©sert froid ?", answers: ["Antarctique", "Arctique", "Gobi"], correct: "Antarctique" },
    { question: "Quel est le plus long film d‚Äôanimation Disney ?", answers: ["Fantasia", "Le Roi Lion", "La Reine des Neiges"], correct: "Fantasia" },
    { question: "Quel est le plus grand reptile ?", answers: ["Crocodile marin", "Python", "Iguane"], correct: "Crocodile marin" },
    { question: "Quel est le plus grand nombre premier √† un chiffre ?", answers: ["7", "9", "5"], correct: "7" },
    { question: "Quel est le plus grand oc√©an ?", answers: ["Atlantique", "Pacifique", "Indien"], correct: "Pacifique" },
    { question: "Quel est le plus grand insecte ?", answers: ["Phasme", "Scarab√©e", "Libellule"], correct: "Phasme" },
    { question: "Quel est le plus grand f√©lin ?", answers: ["Tigre", "Lion", "L√©opard"], correct: "Tigre" },
    { question: "Quel est le plus grand poisson ?", answers: ["Requin-baleine", "Thon", "Espadon"], correct: "Requin-baleine" }
  ]
};

// R√©cup√®re la cat√©gorie depuis l'URL
function getCategory() {
  const params = new URLSearchParams(window.location.search);
  return params.get('cat') || 'culture';
}

const cat = getCategory();
const allQuestions = questionsByCategory[cat] || questionsByCategory['culture'];

// M√©lange et s√©lectionne 10 questions au hasard (ou moins si pas assez)
function getRandomQuestions(arr, n) {
  const shuffled = arr.slice().sort(() => 0.5 - Math.random());
  return shuffled.slice(0, Math.min(n, arr.length));
}

const questions = getRandomQuestions(allQuestions, 10);
let score = 0;
let current = 0;
const scoreboard = document.getElementById('scoreboard');
const quizDiv = document.createElement('div');
document.body.insertBefore(quizDiv, document.getElementById('restart'));

// Change le titre selon la cat√©gorie
const titles = {
  culture: "üß† Quiz Culture G√©n√©rale",
  islam: "üïå Quiz Culture Islamique",
  histoire: "üìú Quiz Histoire",
  geo: "üåç Quiz G√©ographie",
  autres: "‚≠ê Quiz Autres",
  sport: "üèÜ Quiz Sport"
};
document.querySelector('h1').textContent = titles[cat] || titles['culture'];

let timerEnabled = true;
let timerDuration = 15; // secondes par question
let timerInterval;
const timerBar = document.getElementById('timer-bar');
const timerProgress = document.getElementById('timer-progress');

// Ajoute la gestion du mode sans timer
function startQuiz(cat) {
  timerEnabled = !document.getElementById('no-timer').checked;
  window.location.href = `quizz.html?cat=${cat}&timer=${timerEnabled ? 1 : 0}`;
}

// R√©cup√®re le param√®tre timer dans l'URL
function getTimerMode() {
  const params = new URLSearchParams(window.location.search);
  return params.get('timer') !== "0";
}
timerEnabled = getTimerMode();

// Pour stocker les r√©ponses de l'utilisateur
let userAnswers = [];

// Ajoute une propri√©t√© "explication" √† chaque question si tu veux (exemple) :
/*
{ question: "...", answers: [...], correct: "...", explication: "Petite anecdote ou explication." }
*/

function isMathOperationQuestion(q) {
  // V√©rifie si la question contient +, -, √ó, x, *, ou √∑ ou "addition", "soustraction", "multiplication", "division"
  const opRegex = /(\+|\-|\√ó|x|\*|√∑|addition|soustraction|multiplication|division)/i;
  return opRegex.test(q.question);
}

function showQuestion() {
  clearInterval(timerInterval);
  // Timer plus rapide pour les op√©rations math√©matiques simples
  let thisTimerDuration = timerDuration;
  if (cat === "math" && isMathOperationQuestion(questions[current])) {
    thisTimerDuration = 7; // 7 secondes pour les op√©rations
  }
  timerBar.style.display = timerEnabled ? "block" : "none";
  if (current >= questions.length) {
    showFinalScore();
    return;
  }
  const q = questions[current];
  quizDiv.innerHTML = `
    <div class="card">
      <div class="question">${q.question}</div>
      <div class="answers">
        ${q.answers.map(ans => `<button>${ans}</button>`).join('')}
      </div>
      <div class="result"></div>
      <div class="explication" style="margin-top:8px;color:#1de9b6;font-size:0.98em;"></div>
    </div>
  `;
  if (timerEnabled) {
    let timeLeft = thisTimerDuration;
    timerProgress.style.width = "100%";
    timerInterval = setInterval(() => {
      timeLeft--;
      timerProgress.style.width = (timeLeft / thisTimerDuration * 100) + "%";
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        const resultDiv = quizDiv.querySelector('.result');
        resultDiv.textContent = "‚è∞ Temps √©coul√© !";
        resultDiv.style.color = "#ff4081";
        quizDiv.querySelector('.explication').innerHTML = `Bonne r√©ponse : <b>${q.correct}</b>${q.explication ? "<br>" + q.explication : ""}`;
        document.querySelectorAll('.answers button').forEach(b => b.disabled = true);
        userAnswers.push({question: q.question, user: null, correct: q.correct});
        setTimeout(() => { current++; showQuestion(); }, 2000);
      }
    }, 1000);
  }
  document.querySelectorAll('.answers button').forEach(btn => {
    btn.addEventListener('click', () => {
      clearInterval(timerInterval);
      const result = quizDiv.querySelector('.result');
      const explication = quizDiv.querySelector('.explication');
      let isCorrect = btn.textContent === q.correct;
      if (isCorrect) {
        result.textContent = "‚úÖ Bonne r√©ponse !";
        result.style.color = "green";
        score++;
      } else {
        result.textContent = "‚ùå Mauvaise r√©ponse.";
        result.style.color = "red";
        explication.innerHTML = `Bonne r√©ponse : <b>${q.correct}</b>${q.explication ? "<br>" + q.explication : ""}`;
      }
      userAnswers.push({question: q.question, user: btn.textContent, correct: q.correct});
      scoreboard.textContent = `Score : ${score} / ${questions.length}`;
      document.querySelectorAll('.answers button').forEach(b => b.disabled = true);
      setTimeout(() => { current++; showQuestion(); }, 2000);
    });
  });
}

function restartQuiz() {
  window.location.href = "index.html";
}

function goBack() {
  window.location.href = "index.html";
}

function showFinalScore() {
  const ratio = score / questions.length;
  const percent = Math.round(ratio * 100);

  // Pr√©pare la liste des erreurs
  let erreurs = userAnswers
    .map((a, i) => a.user !== a.correct ? {
      question: a.question,
      user: a.user,
      correct: a.correct
    } : null)
    .filter(x => x);

  // Stocke score et erreurs dans le localStorage pour la page finale
  localStorage.setItem('quizResult', JSON.stringify({
    score: score,
    total: questions.length,
    percent: percent,
    erreurs: erreurs
  }));

  // Redirige vers la page finale (nom du fichier : pagefinale.html)
  window.location.href = "pagefinale.html";
}

function showReview() {
  document.getElementById('review-list').style.display = "block";
}

// Met √† jour le score initial
scoreboard.textContent = `Score : 0 / ${questions.length}`;
showQuestion();
  </script>
</body>
</html>
